<p-toast></p-toast>

<p-card>
  <p-toolbar styleClass="p-mb-4">
    <ng-template pTemplate="left">
        <button pButton type="button" label="Adicionar Cliente" icon="pi pi-plus" class="p-button-success p-button-rounded" (click)="openNewClientModal()"></button>
    </ng-template>

    <ng-template pTemplate="right">

    </ng-template>
  </p-toolbar>


  <p-table
  [value]="clientsList"
  styleClass="p-datatable-striped"
  >
    <ng-template pTemplate="header">
      <tr>
          <th>Nome</th>
          <th>E-mail</th>
          <th>Celular</th>
          <th>Cadastrado em</th>
          <th>Projetos</th>
          <th style="width: 15%;">Opções</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-client>
      <tr>
          <td>{{ client.name }}</td>
          <td>{{ client.mail }}</td>
          <td>{{ client.cellphone }}</td>
          <td>{{ client.registeredDate | date: 'dd/MM/yyyy' }}</td>
          <td>{{ client.projects.length }}</td>
          <td>
            <!-- <button pButton pRipple type="button" icon="pi pi-user-plus" class="p-button-rounded p-button-help p-button-text"></button> -->
            <button pButton pRipple type="button" icon="pi pi-user-edit" class="p-button-rounded p-button-info p-button-text"></button>
            <button pButton pRipple type="button" icon="pi pi-user-minus" class="p-button-rounded p-button-danger p-button-text"></button>
            <button pButton pRipple type="button" icon="pi pi-pencil" (click)="openEditClientModal(client)" class="p-button-rounded p-button-warning p-button-text"></button>
            <button pButton pRipple type="button" icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-text"></button>
          </td>
      </tr>
    </ng-template>
  </p-table>

</p-card>

<!-- CLIENTS DIALOG -->
<p-dialog
  [(visible)]="showDialog"
  [style]="{ width: '1200px' }"
  [header]="dialogTitle"
  [modal]="true"
  styleClass="p-fluid"
>
  <ng-template pTemplate="content">
    <div class="p-grid">
      <div class="p-field p-col">
        <label for="fieldId">Nome <span>*</span></label>
        <input id="name" type="text" [(ngModel)]="client.name" [class]="submitted && !client.name ? 'p-invalid' : ''" pInputText>
        <small class="p-invalid" *ngIf="submitted && !client.name">Nome obrigatório.</small>
      </div>

      <div class="p-field p-col">
        <label for="fieldId">E-mail <span>*</span></label>
        <input id="mail" type="email" [(ngModel)]="client.mail" [class]="submitted && !client.mail ? 'p-invalid' : ''" pInputText>
        <small class="p-invalid" *ngIf="submitted && !client.mail">E-mail obrigatório.</small>
      </div>
    </div>

    <div class="p-grid">
      <div class="p-field p-col">
        <label for="fieldId">Celular <span>*</span></label>
        <input id="cellphone" type="text" [(ngModel)]="client.cellphone" [class]="submitted && !client.cellphone ? 'p-invalid' : ''" pInputText>
        <small class="p-invalid" *ngIf="submitted && !client.cellphone">Celular obrigatório.</small>
      </div>

      <div class="p-field p-col">
        <label for="fieldId">Telefone</label>
        <input id="telephone" type="text" [(ngModel)]="client.telephone" pInputText>
      </div>
    </div>

    <div class="p-grid">
      <div class="p-field p-col-12">
        <label for="address">Observações</label>
        <textarea id="observations" type="text" rows="4" [(ngModel)]="client.observations" pInputTextarea></textarea>
      </div>
    </div>

    <p-card header="Projetos">
      <div class="p-grid">
        <div class="p-col-12">
          <p-toolbar>
            <ng-template pTemplate="left">
                <p-button label="Adicionar Projeto" icon="pi pi-plus" styleClass="p-button-sm p-button-success"></p-button>
            </ng-template>

            <ng-template pTemplate="right">

            </ng-template>
          </p-toolbar>
        </div>

        <div class="p-col-12">
          <p-table
            [value]="client.projects"
            styleClass="p-datatable-striped"
            >
              <ng-template pTemplate="header">
                <tr>
                    <th>Descrição</th>
                    <th>Cadastrado em</th>
                    <th>Status</th>
                    <th style="width: 15%;">Opções</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-project>
                <tr>
                    <td>{{project.description}}</td>
                    <td>{{project.registeredDate | date: 'dd/MM/yyyy'}}</td>
                    <td><span [class]="'project-badge status-' + (project.status)">{{project.status}}</span></td>

                    <td>
                      <button pButton pRipple type="button" icon="pi pi-pencil" class="p-button-rounded p-button-warning p-button-text"></button>
                      <button pButton pRipple type="button" icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-text"></button>
                    </td>
                </tr>
              </ng-template>
            </p-table>
        </div>
      </div>
    </p-card>

  </ng-template>

  <ng-template pTemplate="footer">
    <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
    <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text" (click)="saveClient()"></button>
  </ng-template>
</p-dialog>
